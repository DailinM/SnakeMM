<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Snack</title>
        <link rel="stylesheet" type="text/css" href="css\Style.css">
        <link rel="stylesheet" type="text/css" href="css\bootstrap.min.css">
    </head>
    <body> 
        <font color="#d9bf77" face="Comic Sans MS,arial">
        <div class ="cabecera">      
            <h1 style="font-size:10vw; text-align:center;">Snake</h1>
        </div> 

        <div id= "contendorImg" style="display:none">
          <img src="imagen\aguacate.png">
          <img src="imagen\cereza.png"  >
          <img src="imagen\fresa.png"   >
          <img src="imagen\mango.png"   >
          <img src="imagen\diamante.png" >
          <img src="imagen\platano.png" >
        </div>
        
        <div style="display:none"> 
            <img id = "cabezaSerpiente" src="imagen\cabezaserpiente.png">           
            <img id = "pielSerpiente"   src="imagen\pielSerpiente.png">
            
        </div>   

        <div class="left">  
            <div class = "organizarDatos">         
                <div class="timepo"><p>Tiempo</p></div>
                <div class="pts"><p>Puntaje</p></div>
                <div class="ptsAnt"><p>Puntaje Anterior</p></div>
            </div>             
        </div>
        
        <div class ="contenedorCanvas"> 
            <div id = "botonFacil"><a class="botonFacilFlotante" role = "button">Facil</a></div> 
            <div id = "botonDificil"><a class="botonDificilFlotante" role="button">Dificil</a></div>             
            <div id = "botonJugar" ><a class="botonJugarFlotante" role="button">Jugar</a></div> 
            <canvas  id="CanvaSN1" width="800" height="800">
            </canvas>             
        </div> 
        <!--
           
        -->       

        <script>
            var c = document.getElementById("CanvaSN1");
            var ctx = c.getContext("2d");
            var contendorImagenes = document.getElementById('contendorImg');
            var cabezaSnake = document.getElementById('cabezaSerpiente');
            var pielSnake = document.getElementById('pielSerpiente');  
            var botonJuego =  document.getElementById('botonJugar');      
            var botonFacil = document.getElementById('botonFacil'); 
            var botonDificil = document.getElementById('botonDificil');     
            var listaDeImagenes = [];               
            var velocidadMovimiento = {facil:300 , dificil:100};
            var DIMENSION = 40;
            var CUADROSNAKE = c.width/DIMENSION;
            var intervalID = 0        
                ,movimiento = null
                ,pos = null
                ,fruta = null 
                ,snake = null
                ,snakeLong = null
                ,finJuego = null
                ,movimientoProcesado = null
                ,pausa = null;

            for (let i = 0; i < contendorImagenes.childNodes.length; i++) {
                if(contendorImagenes.childNodes[i] && contendorImagenes.childNodes[i].tagName == "IMG")
                    listaDeImagenes.push(contendorImagenes.childNodes[i]);
            }

            var imageFruta = listaDeImagenes[0];

            function aplicarEstiloDegradadoLetras() {
                ctx.font = "100px Candara";
                var gradient = ctx.createLinearGradient(0, 0, c.width, 0);
                gradient.addColorStop("0", "olive");
                gradient.addColorStop("0.5", "Cyan");
                gradient.addColorStop("1.0", "Black"); 
                ctx.fillStyle = gradient;
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";               
            }  

            function ocultarBoton(elementoVisible){
                elementoVisible.style.display = 'none';
            }

            function mostrarBoton(elementoOculto){
                elementoOculto.style.display = 'block';
                
            }

            function escucharAccionBoton(elementoClick, tipoDificultad){
                elementoClick.addEventListener('click', function(ev) {
                    if (elementoClick == botonJuego){
                        mostrarBoton(botonFacil);
                        mostrarBoton(botonDificil);
                        botonJuego.style.pointerEvents = 'none';  
                    } else {
                        ocultarBoton(botonFacil);
                        ocultarBoton(botonDificil);
                        ocultarBoton(botonJuego);
                        iniciaJuego(tipoDificultad); 
                    }                      
                }, false);
            }

            function asignarValorRandom(limiteMaximo) {
                return {
                    x: Math.floor(Math.random() * limiteMaximo),
                    y: Math.floor(Math.random() * limiteMaximo)              
                };
            }

            function compararUbicacionObjetos(valorA, valorB) {
                if (valorA.x == valorB.x && valorA.y == valorB.y) {
                    return true;
                } else {
                    return false;
                }                
            }

            function pintarImagen(contexto, imagenSeleccionada, posicionImgagen, dimensionImagen, nuevaDimension){
                contexto.drawImage(imagenSeleccionada, posicionImgagen.x * dimensionImagen, posicionImgagen.y * dimensionImagen, dimensionImagen ,dimensionImagen );            
            } 

            function reiniciarValores() {
                movimiento = {x:0 , y:0}; 
                pos = {x:0 , y:0};
                fruta = {x:0 , y:0};  
                snake = new Array ();
                snakeLong = 0;
                finJuego = false;
                movimientoProcesado = false;
                pausa = false;
                posicionarFruta (pos, snake);
                posicionarSnake (fruta);
                snake.unshift({x:pos.x, y:pos.y});
                snakeLong = 1;                
            }

            function vaciarPantalla(){
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(0,0,c.width,c.height);
            }
            
            function gameOver() {
                vaciarPantalla();  
                aplicarEstiloDegradadoLetras();          
                ctx.fillText("Game over", c.width/2, c.height/2);
                clearInterval(intervalID);
                reiniciarValores();
                var newGameId = setInterval(newGame, 1000);
                function newGame() {
                    vaciarPantalla();
                    mostrarBoton(botonJuego);
                    botonJuego.style.pointerEvents = 'auto';  
                    clearInterval(newGameId);                    
                }             
            }

            function iniciaJuego(Dificultad) {
                vaciarPantalla();
                jugar();
                intervalID = setInterval(jugar, Dificultad);                 
            }

            function posicionarFruta(posSnake, valorSnake) {
                fruta = asignarValorRandom(CUADROSNAKE); 
                while (  compararUbicacionObjetos(fruta, posSnake)  || coincidenciaPosicionSnake(valorSnake, fruta) != -1 ) {
                    fruta = asignarValorRandom(CUADROSNAKE);
                }                
            }

            function posicionarSnake(posicionFrutaAct) {
                pos = asignarValorRandom(CUADROSNAKE);                
                while (compararUbicacionObjetos(posicionFrutaAct, pos)) {
                    pos = asignarValorRandom(CUADROSNAKE);
                }                
            }

            function coincidenciaPosicionSnake(valorSnake, cordenadaXY) {          
                for (let i = 0; i < valorSnake.length; i++) {
                    if(valorSnake[i].x == cordenadaXY.x && valorSnake[i].y == cordenadaXY.y) {
                        return 1;
                    }                    
                } 
                return -1;                           
            }
            
            function jugar() {
                if (pausa == false) {
                    vaciarPantalla(); 
                    if (movimiento.x != 0 || movimiento.y != 0){
                        pos.x = snake[0].x + movimiento.x;
                        pos.y = snake[0].y + movimiento.y;

                        if (pos.x < 0) {
                            pos.x = CUADROSNAKE -1;
                        }
                        if (pos.y < 0) {
                            pos.y = CUADROSNAKE -1;
                        }
                        if (pos.x > CUADROSNAKE -1) {
                            pos.x = 0;
                        }
                        if (pos.y > CUADROSNAKE -1)  {
                            pos.y = 0;
                        }
                                                
                        if (compararUbicacionObjetos(pos, fruta)) {
                            snakeLong = snakeLong + 1;                           
                            image = listaDeImagenes[asignarValorRandom(listaDeImagenes.length)]
                            posicionarFruta (pos, snake);
                        } else {
                            snake.pop();
                        }

                        if (coincidenciaPosicionSnake(snake, pos) != -1){                            
                            finJuego =  true;  
                        }
                        snake.unshift({x:pos.x, y:pos.y});                
                    }
                    if (finJuego == false) {
                        for (let i = 0; i < snakeLong; i++) {
                            if (i == 0) {
                                pintarImagen(ctx, cabezaSnake, snake[i], DIMENSION);
                            } else{
                                pintarImagen(ctx, pielSnake, snake[i], DIMENSION);
                            }
                        }                        
                        pintarImagen(ctx, imageFruta, fruta, DIMENSION,null);
                    } else {     
                        gameOver();                                  
                    }
                    movimientoProcesado = true;                   
                }                             
            }     
            
            ocultarBoton(botonFacil);
            ocultarBoton(botonDificil);
            escucharAccionBoton(botonJuego, 1);
            escucharAccionBoton(botonFacil, velocidadMovimiento.facil);
            escucharAccionBoton(botonDificil, velocidadMovimiento.dificil);
            reiniciarValores();  
            document.addEventListener('keydown', (event) => {               
                
                if (event.keyCode == 65 || event.keyCode == 87 || event.keyCode == 68 || event.keyCode == 83  ) {
                    pausa = false;
                } else {
                    pausa = true;
                }

                if(movimientoProcesado == true){
                    movimientoProcesado = false;
                    switch (event.keyCode) {
                        case 65:
                            if (movimiento.x != 1){
                                movimiento.x = -1;
                                movimiento.y = 0;                                
                            }
                        break;
                        case 87:
                            if (movimiento.y != 1){
                                movimiento.x = 0;
                                movimiento.y = -1;
                            }
                        break;
                        case 68:
                            if (movimiento.x != -1){
                                movimiento.x = 1;
                                movimiento.y = 0;
                            }
                        break;
                        case 83 :
                            if (movimiento.y != -1){
                                movimiento.x = 0;
                                movimiento.y = 1;
                            }
                        break;        
                    }
                }
            });            
                      
        </script>
    </body>
</html>