<html>
    <head>
        <meta charset="utf-8">
        <title>Snack</title>
        <link rel="stylesheet" type="text/css" href="css\Style.css">
    </head>
    <body bgcolor="black"> 
        <font color="Olive" face="Comic Sans MS,arial">
        <h1 align="center"><i>Snake</i></h1>     
        <div id= "contendorImg" style="display:none">
          <img id= "1" src="imagen\aguacate.png">
          <img id= "2" src="imagen\cereza.png"  >
          <img id= "3" src="imagen\fresa.png"   >
          <img id= "4" src="imagen\mango.png"   >
          <img id= "5" src="imagen\diamante.png" >
          <img id= "6" src="imagen\platano.png" >
        </div> 
        <div id= "contendorImgSerp" style="display:none">            
            <img id = "pielSerpiente" src="imagen\pielserpiente1.png" >
            <img id = "cabezaSerpiente" src="imagen\cabezaserpiente.png" >
        </div>

    
        <div id="tiempoc"> 
            <h3 align="left"><i>Tiempo</i></h3>  
            <p id= "Tiempo">
                <span id= "minutos">00</span>:<span id= "segundos">00</span>
            </p> 
            <h3 align="left"><i>Puntuacion</i></h3> 
            <p id= "puntos">
                <span id= "puntosactual">0000000000</span>
            </p>  
            <h3 align="left"><i>Puntuacion Ant</i></h3>
            <p id= "puntosAnt">
                <span id= "puntosanterior">0000000000</span>
            </p> 
            <button class="button button1" onclick="gameOver('Reinicio')">Reinicio</button>
         <!--  <div id= "im"> 
            <img id="serpiente" src="imagen\serpiente2.png" > 
            </div>
            --> 
        </div>
    
        <div id ="contenedor">
            <canvas  id="CanvaSN1" width="800" height="800">
            </canvas>             
        </div> 
        
        <script>
            var c = document.getElementById("CanvaSN1");
            var ctx = c.getContext("2d");
            var contendorImagenes = document.getElementById('contendorImg');
            var contendorImagenesSerp = document.getElementById('pielSerpiente');
            var contendorCabezaSerp = document.getElementById('cabezaSerpiente');
            var listaDeImagenes = [];               
            var interval = {facil:300 , dificil:100};
            var DIMENSION = 40;
            var CUADROSNAKE = c.width/DIMENSION;
            var intervalID = 0;    
            var cronometro = 0;         
            var movimiento = null; 
            var pos = null;
            var fruta = null;  
            var snake = null;
            var snakeLong = null;
            var finJuego = null;
            var usado = null;
            var pausa = null;
            var puntuacionAnterior = null;
            var puntuacion = null;
            var secs = null;
            var mins = null;            

            for (let i = 0; i < contendorImagenes.childNodes.length; i++) {
                if(contendorImagenes.childNodes[i] && contendorImagenes.childNodes[i].tagName == "IMG")
                    listaDeImagenes.push(contendorImagenes.childNodes[i]);                    
            }

            var image = listaDeImagenes[0];

            function estiloGradientFont() {
                ctx.font = "100px Candara";
                var gradient = ctx.createLinearGradient(0, 0, c.width, 0);
                gradient.addColorStop("0", "olive");
                gradient.addColorStop("0.5", "Cyan");
                gradient.addColorStop("1.0", "Black"); 
                ctx.fillStyle = gradient;
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";               
            }     

            function inicializarJuego() {
                movimiento = {x:0 , y:0}; 
                pos = {x:0 , y:0};
                fruta = {x:0 , y:0};  
                snake = new Array ();
                snakeLong = 0;
                finJuego = false;
                usado = false;
                pausa = false;
                posicionarFruta (pos, snake);
                posicionarSnake (fruta);
                snake.unshift({x:pos.x, y:pos.y});
                snakeLong = 1; 
                puntuacion = 0;
                secs = 0;
                mins = 0;  
                        
            }

            function vaciarPantalla(){
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(0,0,c.width,c.height);
            }

            function menu() {  
                vaciarPantalla();
                estiloGradientFont(); 
                ctx.fillText("Nivel:", c.width/2, c.height/4); 
                ctx.textAlign = "left"; 
                ctx.fillText("* Facil", c.width/3, c.height/2,);            
                ctx.fillText("* Dificil", c.width/3, c.height/1.5); 
                   
            }

            function gameOver(mensaje) {                
                vaciarPantalla();  
                estiloGradientFont();  
                ctx.fillText(mensaje, c.width/2, c.height/2);                
                clearInterval(intervalID);
                inicializarJuego();
                var newGameId = setInterval(newGame, 3000);
                function newGame() {
                    menu();                    
                    clearInterval(newGameId);                    
                }          
            }            

            function InicioTiempo() {
                segundos = 0;
                s = document.getElementById("segundos"); 
                m = document.getElementById("minutos");

                cronometro = setInterval(function() {
                    if (pausa == false) {
                        segundos++;

                        secs = segundos;
                        mins = 0;
                        while (secs>=60) {
                            mins++;
                            secs-=60;
                        }
                    }

                    if (mins<10) {
                        m.innerHTML = "0" + mins;                        
                    } else {
                        m.innerHTML = mins;
                    }

                    if (secs<10) {
                        s.innerHTML = "0" + secs;                        
                    } else {
                        s.innerHTML = secs;
                    }

                    total_secs = secs;
                    
                }, 1000);               
            }

            function puntuacionAct() {
                pts = document.getElementById("puntosactual");
                ptsStr = "0000000000"+puntuacion;
                pts.innerHTML = ptsStr.substr(-10);
            }

            function puntuacionAnt() {
                ptsAnt = document.getElementById("puntosanterior");
                ptsStrAnt = "0000000000"+puntuacionAnterior;
                ptsAnt.innerHTML = ptsStrAnt.substr(-10);;
            }

            function iniciaDificultad(nivel) {
                vaciarPantalla();
                jugar();
                InicioTiempo();
                intervalID = setInterval(jugar, nivel);
                
            }

            function elegirDificultad(e) {      
                if(pausa == false ){        
                    var p = evaluacionClickDificultad(e);                
                    if (p.x >= 280 && p.x <= 280 + 251 &&
                        p.y >= 361 && p.y <= 361 + 73) {
                            iniciaDificultad(interval.facil); 
                    } else if (p.x >= 280 && p.x <= 280 + 292 &&
                            p.y >= 495 && p.y <= 495 + 73) {           
                            iniciaDificultad(interval.dificil);                     
                    } else {
                        menu();
                    }
                } 
            }

            function evaluacionClickDificultad(e) {
                var r = c.getBoundingClientRect();  
                return {
                    x: e.clientX - r.left,
                    y: e.clientY - r.top                    
                };
            }

            function posicionarFruta(pos, snake) {
                fruta.x = Math.floor(Math.random() * CUADROSNAKE);
                fruta.y = Math.floor(Math.random() * CUADROSNAKE);

                while (  (fruta.x == pos.x && fruta.y == pos.y)  || coincidenciaPosicion(snake, fruta.x, fruta.y) != -1 ) {
                    fruta.x = Math.floor(Math.random() * CUADROSNAKE);
                    fruta.y = Math.floor(Math.random() * CUADROSNAKE);
                }                
            }

            function posicionarSnake(fruta) {
                pos.x = Math.floor(Math.random() * CUADROSNAKE);
                pos.y = Math.floor(Math.random() * CUADROSNAKE);

                while (fruta.x == pos.x && fruta.y == pos.y) {
                    pos.x = Math.floor(Math.random() * CUADROSNAKE);
                    pos.y = Math.floor(Math.random() * CUADROSNAKE);
                }                
            }

            function coincidenciaPosicion(snake, x, y) {          
                for (let i = 0; i < snake.length; i++) {
                    if(snake[i].x == x && snake[i].y == y) {
                        return 1;
                    }                    
                } 
                return -1;                           
            }

            function pintarFruta(x, y) {
                ctx.drawImage(image, x * DIMENSION, y * DIMENSION, DIMENSION ,DIMENSION );
            }
            
            function pintarSnake(x,y, valor) {
                if (valor == 1){
                    ctx.drawImage(contendorImagenesSerp, x * DIMENSION, y * DIMENSION, DIMENSION ,DIMENSION );   
                } else {
                    ctx.drawImage(contendorCabezaSerp, x * DIMENSION, y * DIMENSION, DIMENSION ,DIMENSION );   
                }      
            }

            function jugar() {
                if (pausa == false) {                                               
                    puntuacionAct(); 
                    vaciarPantalla(); 
                    if (movimiento.x != 0 || movimiento.y != 0){
                        pos.x = snake[0].x + movimiento.x;
                        pos.y = snake[0].y + movimiento.y;

                        if (pos.x < 0) {
                            pos.x = CUADROSNAKE -1;
                        }
                        if (pos.y < 0) {
                            pos.y = CUADROSNAKE -1;
                        }
                        if (pos.x > CUADROSNAKE -1) {
                            pos.x = 0;
                        }
                        if (pos.y > CUADROSNAKE -1)  {
                            pos.y = 0;
                        }
                        
                        if (pos.x == fruta.x && pos.y == fruta.y) {
                            snakeLong = snakeLong + 1;  // come fruta  
                            if (image.id == 5){
                                puntuacion = puntuacion + 500;
                            } else {
                                puntuacion = puntuacion + 100;                       
                            }  
                            image = listaDeImagenes[Math.floor(Math.random() * listaDeImagenes.length)]                 
                            posicionarFruta (pos, snake);
                        } else {
                            snake.pop();
                        }

                        if (coincidenciaPosicion(snake, pos.x, pos.y) != -1){
                            clearInterval(cronometro);
                            vaciarPantalla();                              
                            finJuego =  true;
                        }
                        snake.unshift({x:pos.x, y:pos.y});                
                    }
                    if (finJuego == false) {
                        for (let i = 0; i < snakeLong; i++) {
                            if (i == 0) {
                                pintarSnake(snake[i].x, snake[i].y, 0);
                            } else {
                                pintarSnake(snake[i].x, snake[i].y, 1);       
                            }                                                                        
                        }
                        pintarFruta(fruta.x,fruta.y); 
                    } else {   
                        puntuacionAnterior = puntuacion;                          
                        puntuacionAnt();
                        gameOver("Game over");                                  
                    }
                    usado = true;                   
                }                             
            }             
               
            menu();

            c.addEventListener('click', elegirDificultad, false);

            inicializarJuego();            
            
            document.addEventListener('keydown', (event) => {
                
                if (event.keyCode != 37 || event.keyCode != 38 || event.keyCode != 39 || event.keyCode != 40 ) {
                    pausa = true;
                } if (event.keyCode == 37 || event.keyCode == 38 || event.keyCode == 39 || event.keyCode == 40 ) {
                    pausa = false;
                }
                if(usado == true){
                    usado = false;
                    switch (event.keyCode) {
                        case 37:
                            if (movimiento.x != 1){
                                movimiento.x = -1;
                                movimiento.y = 0;                                
                            }
                        break;
                        case 38:
                            if (movimiento.y != 1){
                                movimiento.x = 0;
                                movimiento.y = -1;
                            }
                        break;
                        case 39:
                            if (movimiento.x != -1){
                                movimiento.x = 1;
                                movimiento.y = 0;
                            }
                        break;
                        case 40:
                            if (movimiento.y != -1){
                                movimiento.x = 0;
                                movimiento.y = 1;
                            }
                        break;        
                    }
                }
            });            
                       
        </script>
    </body>
</html>